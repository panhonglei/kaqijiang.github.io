---
date: 2018-02-02 15:27:31
layout: post
title: iOSè‡ªåŠ¨åŒ–åˆ†å‘éƒ¨ç½²-æŒç»­åŒ–é›†æˆæ–¹æ¡ˆã€Fastlane+è’²å…¬è‹±+Jenkinsã€‘
category: Other
tags: Other
keywords: iOSè‡ªåŠ¨åŒ–åˆ†å‘éƒ¨ç½² æŒç»­åŒ–é›†æˆæ–¹æ¡ˆ Fastlane è’²å…¬è‹± Jenkins
description: iOSè‡ªåŠ¨åŒ–åˆ†å‘éƒ¨ç½² æŒç»­åŒ–é›†æˆæ–¹æ¡ˆ Fastlane è’²å…¬è‹± Jenkins
---


åŸºç¡€åè¯
---
- Rubyï¼Œä¸€ç§ç®€å•å¿«æ·çš„é¢å‘å¯¹è±¡ï¼ˆé¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ï¼‰è„šæœ¬è¯­è¨€
- RVMæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒå…è®¸æ‚¨è½»æ¾åœ°å®‰è£…ï¼Œç®¡ç†å’Œä½¿ç”¨ä»è§£é‡Šå™¨åˆ°å¤šç»„gemså¤šä¸ªrubyç¯å¢ƒã€‚
- Gems RubyGemsç®€ç§°gemsï¼Œæ˜¯ä¸€ä¸ªç”¨äºå¯¹ Rubyç»„ä»¶è¿›è¡Œæ‰“åŒ…çš„ Ruby æ‰“åŒ…ç³»ç»Ÿã€‚ä¾‹å¦‚ç»å¸¸ç”¨çš„cocoapodså°±éœ€è¦ gem æ¥ç®¡ç†ã€‚
- [Fastlane](https://docs.fastlane.tools/)æ˜¯Felix Krauseå¤§ç¥å†™çš„fastlaneæ˜¯ä¸€å¥—ä½¿ç”¨Rubyå†™çš„è‡ªåŠ¨åŒ–å·¥å…·é›†ï¼Œç”¨äºiOSå’ŒAndroidçš„è‡ªåŠ¨åŒ–æ‰“åŒ…ã€å‘å¸ƒç­‰å·¥ä½œã€‚
- pgyer/fir ç¬¬ä¸‰æ–¹å‘å¸ƒæµ‹è¯•å¹³å°ã€‚

Fastlane å®‰è£…åˆå§‹åŒ–
---
![image](http://upload-images.jianshu.io/upload_images/1345654-f27701c6da64262b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


- ç¡®ä¿ä½ å·²ç»å®‰è£…äº†æœ€æ–°ç‰ˆæœ¬çš„Xcodeå‘½ä»¤è¡Œå·¥å…·ï¼š

```
xcode-select --install
```
- é€‰æ‹©ä½ çš„å®‰è£…æ–¹æ³•ï¼šæ¨èä½¿ç”¨RubyGems å®‰è£…ã€ä¸å‡ºé—®é¢˜å°±ç›´æ¥è¿›è¡Œï¼Œæœ€åæŒ‡å‡ºé—®é¢˜ç‚¹ã€‘


æ–¹æ³• | osæ”¯æŒ | æè¿°
---|---|---
Homebrew     | è‹¹æœç³»ç»Ÿ |brew cask install fastlane
å®‰è£…ç¨‹åºè„šæœ¬ | è‹¹æœç³»ç»Ÿ | [ä¸‹è½½zipæ–‡ä»¶](https://download.fastlane.tools/)ã€‚ç„¶ååŒå‡»installè„šæœ¬ï¼ˆæˆ–åœ¨ç»ˆç«¯çª—å£ä¸­è¿è¡Œï¼‰ã€‚
RubyGems     | å¸¦æœ‰Ruby 2.0.0æˆ–æ›´é«˜ç‰ˆæœ¬çš„macOSæˆ–Linux | sudo gem install fastlane -NV

- åˆå§‹åŒ–

å®‰è£…å®Œæ¯•åï¼Œåœ¨ç»ˆç«¯è¿›å…¥åˆ°ä½ çš„é¡¹ç›®ç›®å½•ä¸‹ã€‚åˆå§‹åŒ–fastlane

```
fastlane init
```
æŒ‰ç…§æç¤ºè¾“å…¥å¼€å‘è€…è´¦å·ï¼ˆä»˜è´¹è´¦å·ï¼‰ è¾“å…¥Bundle Identifier  ç”¨äºåˆå§‹åŒ–é…ç½®ï¼ŒåæœŸå¯åœ¨é…ç½®æ–‡ä»¶æ”¹ã€‚éšä¾¿è¾“å…¥
æ ¹æ®æä¾›çš„ä¿¡æ¯ï¼Œfastlaneä¼šè‡ªåŠ¨ä¸ºæ‚¨ç”Ÿæˆä¸€ä¸ªé…ç½®ã€‚\
æ‚¨å¯ä»¥çœ‹åˆ°æ–°åˆ›å»ºçš„./fastlaneç›®å½•ï¼ŒåŒ…å«Appfileå’ŒFastfileæ–‡ä»¶ã€‚

æœ€æœ‰è¶£çš„æ–‡ä»¶æ˜¯fastlane/Fastfileï¼Œå…¶ä¸­åŒ…å«åˆ†å‘æ‚¨çš„åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚

è¿™æ ·å°±å®Œæˆäº†åˆå§‹åŒ–

[è’²å…¬è‹±æ’ä»¶å®‰è£…](https://www.pgyer.com/doc/view/fastlane)
---
åˆå§‹åŒ–å®Œæ¯•åç›´æ¥åœ¨ç»ˆç«¯è¾“å…¥

```
//fastlane fastlane search_plugins//åˆ—å‡ºå¯ç”¨æ’ä»¶
fastlane add_plugin pgyer//å®‰è£…æ’ä»¶
```
![image.png](http://upload-images.jianshu.io/upload_images/1345654-e7fd68fec801e059.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

æ’ä»¶å®‰è£…æˆåŠŸ\
./fastlaneç›®å½•ä¸‹ä¼šç”ŸæˆPluginfileçš„ä¸€ä¸ªæ–‡ä»¶ã€‚\
æ’ä»¶å®‰è£…ä¸æˆåŠŸï¼Œå°±æ˜¯fastlaneå®‰è£…çš„æœ‰é—®é¢˜ã€‚

é…ç½®Fastlane
---


æ–‡ä»¶å | æè¿°
---|---
Appfile | ä» Apple Developer Portal è·å–å’Œé¡¹ç›®ç›¸å…³çš„ä¿¡æ¯ è¯¦æƒ…
Fastfile | æ ¸å¿ƒæ–‡ä»¶,å­˜æ”¾laneä»»åŠ¡
Deliverfile | deliverçš„é…ç½®æ–‡ä»¶,ä» iTunes Connect è·å–å’Œé¡¹ç›®ç›¸å…³çš„ä¿¡æ¯è¯¦ç»†
metadata | åŒæ­¥iTCä¸­çš„å…ƒæ•°æ®
screenshots | åŒæ­¥iTCä¸­çš„æˆªå›¾

####  [fastlaneå·¥å…·é›†](https://docs.fastlane.tools/actions/)æ˜¯é…ç½®fastlaneæœ€é‡è¦çš„

æ–‡ä»¶å | æè¿°
---|---
[match](https://docs.fastlane.tools/actions/match/) | è¯ä¹¦å’Œé…ç½®æ–‡ä»¶ç®¡ç†å·¥å…·ä¼šé‡ç½®è¯ä¹¦ï¼Œæ¨èæ–°é¡¹ç›®ä½¿ç”¨ã€‚ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ
[cert](https://docs.fastlane.tools/actions/cert/) | è‡ªåŠ¨åˆ›å»ºç®¡ç†iOSä»£ç ç­¾åè¯ä¹¦,ä¼šå»è‡ªåŠ¨åˆ›å»ºè¯ä¹¦ï¼Œæ°¸è¿œä¸ä¼šæ’¤é”€ç°æœ‰çš„è¯ä¹¦ã€‚å¦‚ä¸èƒ½åˆ›å»ºä¼šæŠ¥é”™ã€‚
[sigh](https://docs.fastlane.tools/actions/sigh/) | ç”¨æ¥åˆ›å»ºã€æ›´æ–°ã€ä¸‹è½½ã€ä¿®å¤Provisioning Profileçš„å·¥å…·
[gym](https://docs.fastlane.tools/actions/gym/) | è‡ªåŠ¨åŒ–ç¼–è¯‘æ‰“åŒ…å·¥å…·.shenzhençš„ä»£æ›¿å“.ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ
[pem](https://docs.fastlane.tools/actions/pem/) | è‡ªåŠ¨ç”Ÿæˆã€æ›´æ–°æ¨é€é…ç½®æ–‡ä»¶
[produce](https://docs.fastlane.tools/actions/produce/) | å¦‚æœä½ çš„äº§å“è¿˜æ²¡åœ¨iTunes Connect(iTC)æˆ–è€…Apple Developer Center(ADC)å»ºç«‹ï¼Œproduceå¯ä»¥è‡ªåŠ¨å¸®ä½ å®Œæˆè¿™äº›å·¥ä½œ
[deliver](https://docs.fastlane.tools/actions/deliver/) | è‡ªåŠ¨ä¸Šä¼ æˆªå›¾ï¼ŒAPPçš„å…ƒæ•°æ®ï¼ŒäºŒè¿›åˆ¶(ipa)æ–‡ä»¶åˆ°iTunes Connect
[snapshot](https://docs.fastlane.tools/actions/snapshot/) | è‡ªåŠ¨æˆªå›¾ï¼ˆåŸºäºXcode7çš„UI testï¼‰
[frameit](https://docs.fastlane.tools/actions/frameit/) | å¯ä»¥æŠŠæˆªçš„å›¾ç‰‡è‡ªåŠ¨å¥—ä¸Šä¸€å±‚å¤–è¾¹æ¡†
[pilot](https://docs.fastlane.tools/actions/pilot/) | ç®¡ç†TestFlightçš„æµ‹è¯•ç”¨æˆ·ï¼Œä¸Šä¼ äºŒè¿›åˆ¶æ–‡ä»¶
[boarding](https://docs.fastlane.tools/actions/boarding/) | å»ºç«‹ä¸€ä¸ªæ·»åŠ æµ‹è¯•ç”¨æˆ·ç•Œé¢ï¼Œå‘ç»™æµ‹è¯•è€…ï¼Œå¯è‡ªè¡Œæ·»åŠ é‚®ä»¶åœ°å€ï¼Œå¹¶åŒæ­¥åˆ°iTunes Connect(iTC)
[scan](https://docs.fastlane.tools/actions/scan/) | è‡ªåŠ¨è¿è¡Œæµ‹è¯•å·¥å…·ï¼Œå¹¶ä¸”å¯ä»¥ç”Ÿæˆæ¼‚äº®çš„HTMLæŠ¥å‘Š
[spaceship](https://docs.fastlane.tools/actions/spaceship/) | ä¸ºpilotï¼Œboardingå’Œdeliverç­‰å·¥å…·æä¾›å’Œ iTC å’Œ ADC çš„äº¤äº’APIã€‚spaceshipæœ¬æ¥æ˜¯ä¸ªç‹¬ç«‹çš„é¡¹ç›®ï¼Œåæ¥è¢«Fastlaneæ”¶ç¼–è¿›æ¥
[WatchBuild](https://docs.fastlane.tools/actions/WatchBuild/) |  æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„iTCç›‘æ§å·¥å…·ï¼Œå¼€å¯WatchBuildå¯ä»¥ç›‘æ§iTCä¸Šçš„æ–‡ä»¶çŠ¶æ€ï¼Œå¼¹å‡ºMacOSè‡ªå¸¦çš„Notification
[supply](https://docs.fastlane.tools/actions/supply/) |  Androidè‡ªåŠ¨ä¸Šä¼ åˆ°Google Playå·¥å…·(å¦‚æœæœ‰æ—¶é—´ï¼Œæˆ‘æƒ³æŠŠå›½å†…æä¾›APIçš„Android Storeéƒ½å†™ä¸ªæ’ä»¶è‡ªåŠ¨ä¸Šä¼ ï¼Œè¿™ä¸ªé—®é¢˜ä»10å¹´æˆ‘åˆšå¼€å§‹å·¥ä½œå°±è§‰å¾—æ˜¯ä¸ªç—›ç‚¹)
[screengrab](https://docs.fastlane.tools/actions/screengrab/) |  Androidçš„è‡ªåŠ¨æˆªå›¾å·¥å…·

å…³äºfastfile:
--

- é‡Œé¢å­˜æ”¾äº†å¾ˆå¤šlane,æ¯ä¸ªlaneç›¸å½“äºæŒ‰é¡ºåºæ‰§è¡Œçš„å·¥ä½œæµã€‚æ¯ä¸ªlaneå¯ä»¥å­˜æ”¾å¤šä¸ªaction,actionå¯ä»¥çœ‹åšå…·ä½“çš„æ‰§è¡ŒåŠ¨ä½œ
- ç”Ÿå‘½å‘¨æœŸ

æ‰§è¡Œé¡ºåº | æ–¹æ³•å | è¯´æ˜
---|---|---
1 |before_all |åœ¨æ‰§è¡Œ lane ä¹‹å‰åªæ‰§è¡Œä¸€æ¬¡
2 |before_each |æ¯æ¬¡æ‰§è¡Œ lane ä¹‹å‰éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡
3 |lane |è‡ªå®šä¹‰çš„ä»»åŠ¡
4 |after_each |æ¯æ¬¡æ‰§è¡Œ lane ä¹‹åéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡
5 |after_all |åœ¨æ‰§è¡Œ lane æˆåŠŸç»“æŸä¹‹åæ‰§è¡Œä¸€æ¬¡
6 |error |åœ¨æ‰§è¡Œä¸Šè¿°æƒ…å†µä»»æ„ç¯å¢ƒæŠ¥é”™éƒ½ä¼šä¸­æ­¢å¹¶æ‰§è¡Œä¸€æ¬¡
- ä»»åŠ¡å®šä¹‰

å®šä¹‰ |æ˜¯å¦å¿…é¡» |è¯´æ˜| å¤‡æ³¨
---|---|---|---
desc |false| æ–¹æ³•æè¿° |å¯å¤šæ¬¡ä½¿ç”¨æ‰“åˆ°æ¢è¡Œçš„ç›®çš„
name |true |æ–¹æ³•å |ç¬¦å·åŒ–çš„æ–¹æ³•å
options| false| æ–¹æ³•å‚æ•°| è¿”å› Hash ç±»å‹
task |true |æ–¹æ³•ä¸»ä½“| å‚è€ƒ ruby çš„æ–¹æ³•ä»£ç ä¸”æ”¯æŒ ruby ä»£ç 

- ä¸€ä¸ªç®€å•çš„lane

```
lane :deploy do
  # æ‰§è¡Œ pod instasll
  cocoapods
  # æ‰§è¡Œ carthage bootstrap
  carthage
  # å¢åŠ buildç‰ˆæœ¬å·
  increment_build_number
  # ç¼–è¯‘ä»£ç 
  gym
  # å‘å¸ƒåˆ°Apple Store
  deliver(force: true)
end
```

- [fastlaneç¤ºä¾‹](https://github.com/fastlane/examples)

- è¿™ä¸ªæ˜¯æˆ‘è‡ªå·± é…ç½®åˆ°è’²å…¬è‹±çš„ã€‚åŒæ—¶å¯¼å‡ºipaåˆ°./buildæ–‡ä»¶å¤¹ä¸‹,ä»¥ç‰ˆæœ¬å·å’Œæ‰“åŒ…æ—¶é—´å‘½åã€‚è¿™æ ·å°±ä¿ç•™äº†æ¯ä¸€ç‰ˆæœ¬åŒ…äº†ã€‚

åªéœ€è¦é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œå³å¯

```
fastlane topgyer desc:æ›´æ–°å†…å®¹
```


```
desc "ä¸Šä¼ åˆ°æµ‹è¯•ç‰ˆæœ¬åˆ°è’²å…¬è‹±"
  desc "ç”Ÿæˆæœ¬åœ°ç‰ˆæœ¬"
  lane :topgyer do|option|
    
    #è‡ªåŠ¨å¢åŠ build
    # increment_build_number

    #è‡ªåŠ¨ç”Ÿæˆè¯ä¹¦
    cert

    #è‡ªåŠ¨ç”Ÿæˆé…ç½®æ–‡ä»¶
    # sigh(force: true)//æˆ‘ä½¿ç”¨çš„æ˜¯æ‰‹åŠ¨é…ç½®å…³é—­è¿™ä¸ªã€‚å¦‚éœ€è‡ªåŠ¨åˆ™æ‰“å¼€å³å¯

    #gymé…ç½®,æ‰“åŒ…è¾“å‡ºã€‚

    #fastlane gym --export_method ad-hoc
    #fastlane gym --export_method enterprise
    #fastlane gym --export_method app-store
    scheme_name = "xxxx"//åº”ç”¨åè¯

    #è·å–versionå’Œbuildç‰ˆæœ¬å·
    version = get_info_plist_value(path: "./#{scheme_name}/Info.plist", key: "CFBundleShortVersionString")
    build = get_info_plist_value(path: "./#{scheme_name}/Info.plist", key: "CFBundleVersion")
    
    #å¯¼å‡ºè·¯å¾„
    output_directory = "./build"
    
    #å¯¼å‡ºåç§°
    output_name = "#{scheme_name}_#{version}_#{build}_#{option[:desc]}_#{Time.now.strftime('%Y%m%d%H%M%S')}.ipa"

    gym(
      export_method: "enterprise",//ä¼ä¸šè´¦å·
      scheme: scheme_name, //åè¯
      clean: true,//æ˜¯å¦æ¸…ç†ä¸Šæ¬¡ç¼–è¯‘
      output_directory: output_directory,//å¯¼å‡ºè·¯å¾„
      output_name: output_name//å¯¼å‡ºåè¯
     )

    pgyer(api_key: "1212121", user_key: "121212", update_description: "#{option[:desc]}")//è’²å…¬è‹±è®¾ç½®æŸ¥çœ‹key

  end
```

- æ‰‹åŠ¨é…ç½®è¯ä¹¦ã€‚ fastlaneåˆå§‹åŒ–Gym  fastlane gymä¼šç”Ÿæˆä¸€ä¸ªGymfileçš„æ–‡ä»¶ã€‚å¢åŠ ä¸‹é¢ä»£ç ï¼ŒåŒæ—¶ä¸è¦ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆé…ç½®æ–‡ä»¶è¿™ä¸ªé€‰é¡¹sigh(force: true)

```
export_options(
	 provisioningProfiles: { 
	"com.xxx.xxx" => "profilesName",
	"com.xxx.xxxxxx" => "profilesName1"
  })
```
- scheme è®¾ç½® 
æ²¡æœ‰åœ¨gymæˆ–è€…fastfileå†™åº”ç”¨çš„åå­—çš„è¯ã€‚æ‰“åŒ…çš„æ—¶å€™ä¼šè‡ªåŠ¨æ£€æµ‹å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚åˆ—å‡ºæ¥ä¾›ä½ é€‰æ‹©ã€‚\
ä¹Ÿå¯ä»¥è®¾ç½®ä¸€ä¸‹åœ¨gymä¸­ç›´æ¥èµ‹å€¼ï¼Œæˆ–è€…fastfileä¸­å¢åŠ å³å¯ã€‚





[Fastlaneé—®é¢˜æ±‡æ€»](https://github.com/fastlane/fastlane/issues)
---
ä½¿ç”¨è¿‡ç¨‹ä¸­å‡ºç°äº†å¾ˆå¤šé—®é¢˜ï¼Œå¤§éƒ¨åˆ†é—®é¢˜éƒ½å·²ç»æœ‰äººèººè¿‡æ°´äº†ï¼Œæ‰€ä»¥æœ‰é—®é¢˜å…ˆå»çœ‹çœ‹[issues](https://github.com/fastlane/fastlane/issues)
### gymç¼–è¯‘æŠ¥é”™è§£å†³ä¸äº†è¯·å…ˆæ£€æŸ¥ä¸‰éè¯ä¹¦æ˜¯å¦æœ‰é—®é¢˜
### åˆå§‹åŒ–æŠ¥é”™è¯·æ£€æŸ¥å®‰è£…è·¯å¾„æ˜¯å¦æœ‰é—®é¢˜ã€‚


é—®é¢˜ | è§£å†³æ–¹æ¡ˆ
---|---
ruby -v ç‰ˆæœ¬ä½äº2.0.0 |  gemç‰ˆæœ¬ä¸å¯¹ è¯·å‡çº§rubyè¯·æ›´æ–°gems
cocoapodsæ²¡æœ‰æ”¾åˆ°Gemfileä¸­|  Gemfileæ–‡ä»¶ä¸­å¢åŠ cocoapods
fastlane init æç¤ºsudo|è¯·æ£€æŸ¥rubyè·¯å¾„ã€‚å¦‚æœæ²¡é—®é¢˜è¯·æ£€æŸ¥userç›®å½•ä¸‹.bash_profileã€‚ç¯å¢ƒå˜é‡è®¾ç½®æ˜¯å¦æœ‰æ•ˆã€‚export PATH="$HOME/.fastlane/bin:$PATH"
å¦‚æœåˆå§‹åŒ–æˆåŠŸ|å…¶ä»–çš„é—®é¢˜å¤§éƒ¨åˆ†éƒ½æ˜¯è¯ä¹¦é—®é¢˜äº†ã€‚

JenkinsæŒç»­é›†æˆ
---
åœ¨æŒç»­é›†æˆ(Continuous integrationï¼Œç®€ç§°CI)è¿™å—ï¼ŒJenkinsæ— ç–‘æ˜¯ç›®å‰ä½¿ç”¨çš„æ¯”è¾ƒå¤šçš„ä¸€ä¸ªå¼€æºæ¡†æ¶
![jekins.png](http://upload-images.jianshu.io/upload_images/1345654-b9d82620a9ab4d03.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

## JDK
ç³»ç»Ÿè¦æ±‚ï¼šå¿…é¡»å®‰è£…JDK 1.5ä»¥ä¸Šç‰ˆæœ¬ï¼Œæ¨èå®‰è£…æœ€æ–°ç‰ˆæœ¬çš„JDK[æ³¨æ„ä¸æ”¯æŒjava9]ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å®‰è£…JDKå’ŒJDKç‰ˆæœ¬ã€‚[JDKä¸‹è½½é“¾æ¥](http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html)
å¦‚éœ€å¸è½½è¯·çœ‹ä¸‹æ–‡
```
java -version
````
![1.png](http://upload-images.jianshu.io/upload_images/1345654-00b424df522b5405.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
![JDK](http://upload-images.jianshu.io/upload_images/1345654-2b87c68021de9331.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

- javaå¸è½½æ–¹æ³• ä»¥Macä¸ºä¾‹å­  [shift +cmd+g] å‰å¾€æ–‡ä»¶å¤¹
![1](http://upload-images.jianshu.io/upload_images/1345654-f1cbeba8c78f6c55.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
![åˆ é™¤æ‰€é€‰ç‰ˆæœ¬](http://upload-images.jianshu.io/upload_images/1345654-a70b56e82969824c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

- åœ¨ç³»ç»Ÿåå¥½è®¾ç½®é¢æ¿ç§»é™¤Java
![Snip20180126_14.png](http://upload-images.jianshu.io/upload_images/1345654-6886f25ffc4c4ae5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
- JDKå®‰è£…
ä¸‹è½½å®Œæ¯•JDKåå¦‚å›¾æŒ‰ç…§æç¤ºå®‰è£…å³å¯
![Snip20180126_15.png](http://upload-images.jianshu.io/upload_images/1345654-a80a08d94e19b611.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
![java](http://upload-images.jianshu.io/upload_images/1345654-e7ebab1e0d25c6b4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

## å®‰è£… Jenkins
[Jenkinsçš„å®˜ç½‘](https://jenkins.io/download/) ä¸‹è½½æœ€æ–°çš„ war åŒ…ã€‚
æ¨èä½¿ç”¨ã€Long-term Support (LTS)ç¨³å®šç‰ˆã€‘
![war åŒ…](http://upload-images.jianshu.io/upload_images/1345654-205cf583f4e0f8fd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

ä¸‹è½½å®Œæˆåï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œè¿›å…¥åˆ° war åŒ…æ‰€åœ¨ç›®å½•ç›´æ¥è¿è¡Œï¼Œä¹Ÿå¯ä»¥å°†waråŒ…ä¸¢åœ¨Tomcatçš„webappç›®å½•ä¸‹é¢ã€‚
ç»ˆç«¯æ–¹å¼æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
```
java -jar jenkins.war//é»˜è®¤å¯¹ç«¯å£æ˜¯8080å¦‚éœ€æŒ‡å®šå¯æ›´æ”¹
java -jar jenkins.war --httpPort=8888 //æŒ‡å®š8888ç«¯å£äºŒè€…é€‰ä¸€å³å¯
```
### åˆå§‹åŒ–Jenkins

å¾…Jenkinså¯åŠ¨åï¼Œåœ¨æµè§ˆå™¨é¡µé¢è¾“å…¥ä»¥ä¸‹åœ°å€:
```
http://localhost:8888//ç«¯å£æŒ‡å®šçš„å¤šå°‘å†™å¤šå°‘
```
###### æ³¨æ„ä¸è¦å…³é—­ç»ˆç«¯

ç¬¬ä¸€æ¬¡è¿è¡Œä¼šå‡ºç°å¦‚ä¸‹ç•Œé¢ï¼Œæç¤ºéœ€è¦å¡«å†™æŒ‡å®šè·¯å¾„æ–‡ä»¶é‡Œé¢çš„å†…å®¹ï¼ˆè¯¥å†…å®¹ä¹Ÿå¯ä»¥åœ¨ç»ˆç«¯ä¸Šé¢çœ‹åˆ°ï¼‰ã€‚
![jenkins.png](http://upload-images.jianshu.io/upload_images/1345654-54df9f23ba433e42.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
æ ¹æ®æç¤ºç›®å½•æ‰“å¼€initialAdminPasswordæ–‡ä»¶ï¼Œå¤åˆ¶å‡ºå¯†ç ï¼Œå¡«å†™ï¼ŒContinue.
Jenkinsç”¨æˆ·/secrets/ç›®å½•æ˜¯æ²¡æœ‰è¯»å†™æƒé™çš„ã€‚ä¿®æ”¹æƒé™ã€‚
![å®‰è£…æ¨èçš„æ’ä»¶](http://upload-images.jianshu.io/upload_images/1345654-ef5e8f552225dad2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
![ ç­‰å¾…è¿›åº¦æ¡å®ŒæˆÂ·Â·Â· ](http://upload-images.jianshu.io/upload_images/1345654-9c1d41eac60b5e0c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
![ åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·](http://upload-images.jianshu.io/upload_images/1345654-3292adf25eecf324.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
![next](http://upload-images.jianshu.io/upload_images/1345654-0a7995618d991c70.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
![è®¾ç½®å®Œæˆ](http://upload-images.jianshu.io/upload_images/1345654-e4dd895f2f668feb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
è¿™æ ·Jenkinsåˆå§‹åŒ–å®Œæ¯•äº†ï¼Œå¯ä»¥å¿«ä¹çš„ä½¿ç”¨äº†ã€‚è¿˜æ˜¯ä»‹ç»ä¸‹å¦‚ä½•ä½¿ç”¨å§ã€‚

###Jenkinsä½¿ç”¨
- å¯åŠ¨æ–¹å¼
ä¸Šæ–‡è¯´äº†ï¼Œå¦‚ä½•åˆå§‹åŒ–è¿›å…¥Jenkins,é‚£ä¹ˆå¦‚æœæˆ‘å…³äº†å†æ¬¡æ€ä¹ˆè¿›å…¥å‘¢ã€‚åˆ«æ€¥hold~~~ ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥
- æ–¹å¼ä¸€  è·Ÿåˆå§‹åŒ–ä¸€æ ·ï¼Œè¿›å…¥waråŒ…æ‰€åœ¨ç›®å½•é€šè¿‡å‘½ä»¤å¯åŠ¨,
```
java -jar jenkins.war
```
- æ–¹å¼äºŒ è¿è¡Œå‘½ä»¤æ¥åˆ›å»ºé…ç½®æ–‡ä»¶
```
sudo touch /Library/LaunchDaemons/org.jenkins-ci.plist
```
å¦‚æœæ‚¨ä½¿ç”¨äº†ä¸åŒçš„ç”¨æˆ·åï¼Œè¯·åŠ¡å¿…åœ¨plistä¸­ä½¿ç”¨å®ƒã€‚éœ€è¦æŒ‡å®šç”¨æˆ·åï¼Œå¦åˆ™ä¼šä»¥ç³»ç»Ÿæ ¹ç”¨æˆ·çš„èº«ä»½è¿è¡Œï¼Œè¿™ä¼šè®©æ‚¨åœ¨ä½¿ç”¨Jenkinsæ—¶é‡åˆ°éº»çƒ¦
plistå†…å®¹å¦‚ä¸‹
```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
  <dict>
    <key>Label</key>
    <string>Jenkins</string>
    <key>KeepAlive</key>
    <true/>
    <key>ProgramArguments</key>
    <array>
      <string>/usr/bin/java</string>
      <string>-Dmail.smtp.starttls.enable=true</string>
      <string>-jar</string>
      <string>/usr/local/opt/jenkins/libexec/jenkins.war</string>
      <string>--httpListenAddress=127.0.0.1</string>
      <string>--httpPort=8080</string>
    </array>
    <key>RunAtLoad</key>
    <true/>
    <key>UserName</key>
    <string>jenkins</string>
  </dict>
</plist>
```
ç°åœ¨å¯ä»¥é‡æ–°å¯åŠ¨æˆ–è€…è¿è¡Œä¸‹æ–¹å‘½ä»¤æ¥æŸ¥çœ‹è¿è¡Œåœ¨http://localhost:8888çš„Jenkins ã€‚
```
sudo launchctl load -w /Library/LaunchDaemons/org.jenkins-ci.plist
```
###Jenkinsé…ç½®
![ç³»ç»Ÿç®¡ç†](http://upload-images.jianshu.io/upload_images/1345654-9d4384d9a95fcb83.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

####æ’ä»¶ç®¡ç†
ä½¿ç”¨é»˜è®¤æ–¹å¼å®‰è£…çš„åŸºæœ¬æ’ä»¶éƒ½åŒ…å«äº†ï¼Œå¦‚æœæœ‰éœ€è¦å¯ä»¥è‡ªå·±æ¥ç®¡ç†æ’ä»¶
![image.png](http://upload-images.jianshu.io/upload_images/1345654-541e1fdcf0a8f2f2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

####å®‰å…¨é…ç½®
åœ¨å·¥ä½œä¸­å¯èƒ½è¦åœ¨Jenkinsä¸­åˆ›å»ºç”¨æˆ·ï¼Œè¿™æ ·ä½ çš„å›¢é˜Ÿçš„å…¶ä»–æˆå‘˜å°±å¯ä»¥è®¿é—®è‡ªå·±çš„å·¥ä½œã€‚é¦–å…ˆæ‰“å¼€å·¦ä¾§èœå•ä¸­çš„â€œç®¡ç†Jenkinsâ€é¡µé¢ï¼Œç„¶åè½¬åˆ°â€œé…ç½®å…¨å±€å®‰å…¨æ€§â€ã€‚
å¯ç”¨å®‰å…¨æ€§ï¼Œå¦‚æœä¸é‚£ä¹ˆå°†å…è®¸ä»»ä½•ç™»å½•ç”¨æˆ·åšä»»ä½•äº‹æƒ…ã€‚
- è¿›å…¥ç³»ç»Ÿç®¡ç† -> Configure Global Security -> ç‚¹å‡»â€å¯ç”¨å®‰å…¨â€ ã€‚å¯ç”¨å®‰å…¨ä¸‹é¢é€‰æ‹©ï¼Œâ€œJenkinsä¸“æœ‰ç”¨æˆ·æ•°æ®åº“â€ï¼Œå‹¾é€‰å…è®¸ç”¨æˆ·å¯ä»¥æ³¨å†Œã€‚ç„¶ååœ¨â€œæˆæƒç­–ç•¥â€ä¸­é€‰æ‹©â€œä»»ä½•ç”¨æˆ·å¯ä»¥åšä»»ä½•äº‹(æ²¡æœ‰ä»»ä½•é™åˆ¶)â€ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨LDAPèº«ä»½è®¤è¯æœºåˆ¶ï¼Œç›´æ¥ä½¿ç”¨å¤–éƒ¨ç»Ÿä¸€çš„èº«ä»½æœºåˆ¶æ¥åšè®¤è¯ã€‚
- è¿”å›æ³¨å†Œä¸€ä¸ªè´¦æˆ·ï¼Œç™»å½•ä¹‹åå†æ¬¡è¿›å…¥å®‰å…¨ç®¡ç†ã€‚å‹¾é€‰â€œç™»å½•ç”¨æˆ·å¯ä»¥åšä»»ä½•äº‹â€ï¼Œè¿™æ ·å°±åªæœ‰ç™»å½•ç”¨æˆ·æ‰èƒ½åšæ“ä½œäº†ã€‚
![image.png](http://upload-images.jianshu.io/upload_images/1345654-9e4af655f4b0552f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

####é…ç½®git
-  â€œæ–°å»ºâ€ â€”> å‹¾é€‰â€œæ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®â€  -> â€œæºç ç®¡ç†â€ä¸­å‹¾é€‰â€œGitâ€
- è®¾ç½®æºç çš„ä»“åº“ï¼Œä»¥ä¾¿è®© Jenkins çŸ¥é“æˆ‘ä»¬çš„ iOS é¡¹ç›®çš„ä»£ç åœ¨å“ªé‡Œã€‚å› ä¸ºæˆ‘çš„ä»£ç æ”¾åœ¨è‡ªå·±çš„ä»“åº“ä¸­ï¼ˆå¦‚æœä½ ç”¨ Github ç­‰å…¶ä»–ä»“åº“ä¹Ÿæ˜¯ç±»ä¼¼ï¼‰ï¼Œæ‰€ä»¥è¦å…ˆå‘Šè¯‰ Jenkins å¦‚ä½•è·å–ä»£ç ã€‚
é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦é…ç½® SSHï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Jenkins çš„è¯ä¹¦ç®¡ç†ä¸­æ·»åŠ  SSHã€‚åœ¨ Jenkins ç®¡ç†é¡µé¢ï¼Œé€‰æ‹©â€œCredentialsâ€ï¼Œç„¶åé€‰æ‹©â€œGlobal credentials (unrestricted)â€ï¼Œç‚¹å‡»â€œAdd Credentialsâ€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å¡«å†™è‡ªå·±çš„ SSH ä¿¡æ¯ï¼Œç„¶åç‚¹å‡»â€œSaveâ€ï¼Œè¿™æ ·å°±æŠŠ SSH æ·»åŠ åˆ° Jenkins çš„å…¨å±€åŸŸä¸­å»äº†ã€‚
è´¦å·å¯†ç å¡«å†™gitçš„è´¦å·å¯†ç ã€‚
![ssh](http://upload-images.jianshu.io/upload_images/1345654-2b28e79f8ebeb480.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
- å…³äºå¦‚ä½•è·å–SSHå¤§å®¶å¯ä»¥çœ‹æ–‡å°¾ï¼Œç†Ÿæ‚‰çš„äººåº”è¯¥éƒ½ä¼šï¼Œä¸åœ¨æ­¤ä»‹ç»

- å›åˆ°åˆšåˆšæ–°å»ºçš„ä»»åŠ¡ä¸­ï¼Œåœ¨æºç ç®¡ç†ä¸­ï¼Œé€‰æ‹© Gitï¼ŒæŒ‰ä¸‹å›¾å¡«å¥½ç›¸å…³ä¿¡æ¯ã€‚æ³¨æ„ï¼šCredentials ä¸éœ€è¦é€‰æ‹©ã€‚
- åŒæ—¶ä¹Ÿè¯•äº†ä½¿ç”¨è´¦å·å¯†ç çš„Credentialsã€‚é€‰æ‹©ä½ è´¦å·å¯†ç åˆ›å»ºçš„Credentialsä¹Ÿå¯ä»¥ã€‚é»˜è®¤ä½¿ç”¨ä¸Šè¾¹æ–¹æ³•å³å¯ã€‚
![image.png](http://upload-images.jianshu.io/upload_images/1345654-ab5d1538724b3223.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
### è‡ªåŠ¨æµ‹è¯•å¿½ç•¥ï¼Œä¸éœ€è¦è®¾ç½®è§¦å‘å™¨ã€‚
### æ„å»ºç¯å¢ƒè®¾ç½®
- ç›´æ¥ç”¨ fastlane è¿™ä¸ªå·¥å…·ï¼Œæ‰€ä»¥è¿™é‡Œä¸éœ€è¦ç‰¹åˆ«è®¾ç½®ã€‚
### æ„å»ºè®¾ç½®
- é€‰æ‹©ä½¿ç”¨shellè¿›è¡Œæ„å»º æ›´æ–°å†…å®¹è‡ªå·±ç»´æŠ¤
```
cd /users/xxx/xxx   //ä½ é¡¹ç›®æ ¹ç›®å½•
fastlane topgyer desc:æ›´æ–°å†…å®¹!
```
### æ„å»ºåå¢åŠ æ­¥éª¤
- å¯ä»¥é‚®ä»¶é€šçŸ¥äººå‘˜ï¼Œé€—å·éš”å¼€ï¼Œé€šçŸ¥æ„å»ºå¤±è´¥

æ¥ä¸ªæ•´ä½“æˆªå›¾
![12.png](http://upload-images.jianshu.io/upload_images/1345654-90079aa9a2a4cce1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### å¼€å§‹æ„å»º
- è¿”å›é¢æ¿ä¼šå‘ç°è‡ªå·±åˆšæ‰æ–°å»ºçš„ä»»åŠ¡
![image.png](http://upload-images.jianshu.io/upload_images/1345654-35976afe70ea9039.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
- ç‚¹å‡»ä»»åŠ¡åç§°è¿›å…¥è¯¦æƒ…ã€å¯ä»¥ä¿®æ”¹ä»»åŠ¡é…ç½®é¡¹å’Œæ„å»ºç‰ˆæœ¬
![image.png](http://upload-images.jianshu.io/upload_images/1345654-e3ceeec8d90bd0c9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
- ç‚¹å‡»æ„å»º
- ä¼‘æ¯ä¸€ä¼š
- ç™»é™†è’²å…¬è‹±å°±ä¼šå‘ç°å¤šäº†ä¸€ä¸ªç‰ˆæœ¬ã€‚
### æ„å»ºæ—¥å¿—æŸ¥çœ‹
- æ„å»ºå¤±è´¥æˆ–è€…æƒ³çœ‹åˆ°è¾“å‡ºçš„ï¼Œå¯ä»¥åœ¨ä»»åŠ¡è¯¦æƒ…ï¼Œæ„å»ºå†å²ä¸­ï¼Œé€‰æ‹©æ„å»ºä¸­çš„ç‰ˆæœ¬ã€‚
![image.png](http://upload-images.jianshu.io/upload_images/1345654-acc760cd145d656d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
- é€‰æ‹©Console Outputå³å¯çœ‹åˆ°æ§åˆ¶å°è¾“å‡º
![image.png](http://upload-images.jianshu.io/upload_images/1345654-d411785ddf7fcb18.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
- æˆªå–ä¸‹æœ€åè¾“å‡ºsuccessé€ç»™ä½ 
![image.png](http://upload-images.jianshu.io/upload_images/1345654-7a6446326edd9520.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


####èŠ‚ç‚¹ç®¡ç†å¯ä»¥å‚è€ƒä»¥ä¸‹ï¼Œæš‚æ—¶ä¸ä»‹ç»
http://blog.csdn.net/birthmarkqiqi/article/details/62236437
https://www.jianshu.com/p/047362b11403



# é™„åŠ  SSH
## [](https://code.aliyun.com/help/ssh/README#ssh-keys)SSH keys

SSH key å¯ä»¥è®©ä½ åœ¨ä½ çš„ç”µè„‘å’ŒCodeæœåŠ¡å™¨ä¹‹é—´å»ºç«‹å®‰å…¨çš„åŠ å¯†è¿æ¥ã€‚ å…ˆæ‰§è¡Œä»¥ä¸‹è¯­å¥æ¥åˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨æœ¬åœ°å…¬é’¥ï¼š

```
cat ~/.ssh/id_rsa.pub
```

å¦‚æœä½ çœ‹åˆ°ä¸€é•¿ä¸²ä»¥ `ssh-rsa`æˆ– `ssh-dsa`å¼€å¤´çš„å­—ç¬¦ä¸², ä½ å¯ä»¥è·³è¿‡ `ssh-keygen`çš„æ­¥éª¤ã€‚

æç¤º: æœ€å¥½çš„æƒ…å†µæ˜¯ä¸€ä¸ªå¯†ç å¯¹åº”ä¸€ä¸ªssh keyï¼Œä½†æ˜¯é‚£ä¸æ˜¯å¿…é¡»çš„ã€‚ä½ å®Œå…¨å¯ä»¥è·³è¿‡åˆ›å»ºå¯†ç è¿™ä¸ªæ­¥éª¤ã€‚è¯·è®°ä½è®¾ç½®çš„å¯†ç å¹¶ä¸èƒ½è¢«ä¿®æ”¹æˆ–è·å–ã€‚

ä½ å¯ä»¥æŒ‰å¦‚ä¸‹å‘½ä»¤æ¥ç”Ÿæˆssh keyï¼š

```
ssh-keygen -t rsa -C "kaqijiang@sina.cn"
```

è¿™ä¸ªæŒ‡ä»¤ä¼šè¦æ±‚ä½ æä¾›ä¸€ä¸ªä½ç½®å’Œæ–‡ä»¶åå»å­˜æ”¾é”®å€¼å¯¹å’Œå¯†ç ï¼Œä½ å¯ä»¥ç‚¹å‡»Enteré”®å»ä½¿ç”¨é»˜è®¤å€¼ã€‚

ç”¨ä»¥ä¸‹å‘½ä»¤è·å–ä½ ç”Ÿæˆçš„å…¬é’¥ï¼š

```
cat ~/.ssh/id_rsa.pub
```

å¤åˆ¶è¿™ä¸ªå…¬é’¥æ”¾åˆ°ä½ çš„ä¸ªäººè®¾ç½®ä¸­çš„SSH/My SSH Keysä¸‹ï¼Œè¯·å®Œæ•´æ‹·è´ä»`ssh-`å¼€å§‹ç›´åˆ°ä½ çš„ç”¨æˆ·åå’Œä¸»æœºåä¸ºæ­¢çš„å†…å®¹ã€‚

å¦‚æœæ‰“ç®—æ‹·è´ä½ çš„å…¬é’¥åˆ°ä½ çš„ç²˜è´´æ¿ä¸‹ï¼Œè¯·å‚è€ƒä½ çš„æ“ä½œç³»ç»Ÿä½¿ç”¨ä»¥ä¸‹çš„å‘½ä»¤ï¼š

**Windows:**

```
clip < ~/.ssh/id_rsa.pub
```

**Mac:**

```
pbcopy < ~/.ssh/id_rsa.pub
```

**GNU/Linux (requires xclip):**

```
xclip -sel clip < ~/.ssh/id_rsa.pub
```